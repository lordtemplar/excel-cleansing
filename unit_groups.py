import pandas as pd

# Define unit groups
unit_groups = {
    "กลุ่มที่ 1": [
        "พล.1 รอ.", "ร.31 รอ.", "ร.31 พัน.1 รอ.", "ร.31 พัน.2 รอ.", "ร.31 พัน.3 รอ.",
        "ป.1 พัน.1 รอ.", "ป.1 พัน.11 รอ.", "ป.1 พัน.31 รอ.",
        "ม.พัน.4 พล.1 รอ.", "ช.พัน.1 พล.1 รอ.", "ส.พัน.1"
    ],
    "กลุ่มที่ 2": [
        "พล.ร.2 รอ.", "ร.2 รอ.", "ร.2 พัน.1 รอ.", "ร.2 พัน.2 รอ.", "ร.2 พัน.3 รอ.",
        "ร.12 รอ.", "ร.12 พัน.1 รอ.", "ร.12 พัน.2 รอ.", "ร.12 พัน.3 รอ.",
        "ร.21 รอ.", "ร.21 พัน.1 รอ.", "ร.21 พัน.2 รอ.", "ร.21 พัน.3 รอ.",
        "ป.2 พัน.2 รอ.", "ป.2 พัน.12 รอ.", "ป.2 พัน.21 รอ.", "ป.2 พัน.102 รอ.",
        "ม.พัน.2 รอ. พล.ร.2 รอ.", "ม.พัน.30 รอ. พล.ร.2 รอ.", "ช.พัน.2 พล.ร.2 รอ.",
        "ส.พัน.2", "พัน.ซบร.กรม สน.2"
    ],
    "กลุ่มที่ 3": [
        "พล.ร.9 รอ.", "ร.9 พัน.1", "ร.9 พัน.2", "ร.9 พัน.3", "ร.19 พัน.1", "ร.19 พัน.2", "ร.19 พัน.3",
        "ร.29 พัน.1", "ร.29 พัน.2", "ร.29 พัน.3", "ป.9 พัน.9", "ป.9 พัน.19", "ป.9 พัน.109",
        "พัน.ขส.กรม สน.พล.ร.9", "พัน.ซบร.กรม สน.พล.ร.9", "ม.พัน.19 พล.ร.9", "ช.พัน.9 พล.ร.9", "ส.พัน.9 พล.ร.9"
    ],
    "กลุ่มที่ 4": [
        "พล.ร.11", "พัน.ซบร.กรม สน.พล.ร.11", "ร.111 พัน.1", "ร.111 พัน.2", "ร.111 พัน.3",
        "ร.112 พัน.1", "ร.112 พัน.2", "ร.112 พัน.3"
    ],
    "กลุ่มที่ 5": [
        "พล.ม.2 รอ.", "ม.1 พัน.1 รอ.", "ม.1 พัน.3 รอ.", "ม.1 พัน.17 รอ.", "ม.4 พัน.5 รอ.",
        "ม.4 พัน.11 รอ.", "ม.4 พัน.25 รอ.", "ม.5 พัน.20 รอ.", "ม.5 พัน.23 รอ.",
        "ม.5 พัน.24 รอ.", "ม.พัน.27 พล.ม.2 รอ.", "ม.พัน.29 รอ.", "ส.พัน.12", "พัน.ซบร.กรม สน.12"
    ],
    "กลุ่มที่ 6 อื่นๆ": [
        "พัน.พัฒนา.1", "ช.1 พัน.112 รอ.", "ช.1 พัน.52 รอ.", "พัน.สพ.กระสุน 21 บชร.1",
        "พัน.สบร.21 บชร.1", "หน่วยฝึกที่ 1", "หน่วยฝึกที่ 2", "หน่วยฝึกที่ 3", "พัน.สห.11",
        "มทบ.13", "มทบ.14", "มทบ.15", "มทบ.16", "มทบ.17", "มทบ.18", "มทบ.19",
        "บก.ทภ.1 (ส.พัน.21 ทภ.1)"
    ]
}

def count_by_group(df, unit_groups):
    # Count people by each group
    group_counts = {}
    for group_name, units in unit_groups.items():
        group_counts[group_name] = df["สังกัด(หน่วยฝึกทหารใหม่)"].isin(units).sum()

    return pd.DataFrame(list(group_counts.items()), columns=["กลุ่ม", "จำนวนคน"])

def count_by_unit(df):
    # Count people by each unit
    unit_counts = df["สังกัด(หน่วยฝึกทหารใหม่)"].value_counts().reset_index()
    unit_counts.columns = ["หน่วย", "จำนวนคน"]

    # Map each unit to its group
    group_mapping = {}
    for group_name, units in unit_groups.items():
        for unit in units:
            group_mapping[unit] = group_name

    # Add group column to the DataFrame
    unit_counts["กลุ่ม"] = unit_counts["หน่วย"].map(group_mapping).fillna("ไม่ระบุ")

    return unit_counts
